<!DOCTYPE html>
<!-- v7 - greedy+æ¢ç´¢ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ 2026-02-02 21:05 -->
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚²ãƒ¼ãƒ æ©Ÿ è²·å–ç‡ãƒˆãƒ©ãƒƒã‚«ãƒ¼ | C-Creation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@400;500;700&family=DM+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --accent: #f97316;
            --success: #22c55e;
            --warning: #eab308;
            --danger: #ef4444;
            --surface: #ffffff;
            --surface-dim: #f8fafc;
            --border: #e2e8f0;
            --text: #0f172a;
            --text-sub: #475569;
            --text-muted: #94a3b8;
            --radius: 14px;
            --shadow: 0 4px 20px rgba(0,0,0,0.08);
            --fn: 'DM Sans', sans-serif;
            --fj: 'Zen Kaku Gothic New', sans-serif;
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family: var(--fj); background: #0f172a; min-height: 100vh; color: var(--text); }
        .container { max-width: 1200px; margin: 0 auto; padding: 16px; }

        /* ===== ãƒ˜ãƒƒãƒ€ãƒ¼ ===== */
        .header {
            background: linear-gradient(135deg, #1e3a5f, #0c1e36);
            border-radius: var(--radius); padding: 24px 28px; margin-bottom: 12px;
            border: 1px solid rgba(255,255,255,0.06);
        }
        .header h1 { font-size: 1.5rem; font-weight: 700; color: #f1f5f9; letter-spacing: -0.02em; }
        .header-meta { display: flex; flex-wrap: wrap; gap: 16px; color: #64748b; font-size: 0.78rem; margin-top: 4px; }
        .update-time::before { content: "ğŸ• "; }

        /* ===== ã‚¿ãƒ– ===== */
        .tabs { display: flex; gap: 4px; margin-bottom: 12px; background: #1e293b; border-radius: 12px; padding: 4px; }
        .tab-btn {
            flex: 1; padding: 11px 8px; background: transparent; border: none; border-radius: 9px;
            font-size: 0.8rem; font-weight: 600; cursor: pointer; transition: all 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 5px;
            color: #64748b; font-family: var(--fj);
        }
        .tab-btn:hover { color: #cbd5e1; background: rgba(255,255,255,0.04); }
        .tab-btn.active { background: var(--surface); color: var(--text); box-shadow: 0 2px 8px rgba(0,0,0,0.12); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* ===== æ¤œç´¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ ===== */
        .search-section { background: var(--surface); border-radius: var(--radius); padding: 24px 28px; margin-bottom: 16px; box-shadow: var(--shadow); }
        .search-title { font-size: 1.15rem; font-weight: 700; margin-bottom: 18px; display: flex; align-items: center; gap: 8px; }
        .search-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 18px; }
        .form-group { display: flex; flex-direction: column; gap: 6px; }
        .form-label { font-weight: 600; color: var(--text-sub); font-size: 0.82rem; }
        .form-input { padding: 12px 16px; border: 2px solid var(--border); border-radius: 10px; font-size: 1.2rem; font-weight: 700; transition: border-color 0.2s; font-family: var(--fn); }
        .form-input:focus { outline: none; border-color: var(--primary); }
        .form-hint { font-size: 0.72rem; color: var(--text-muted); }
        .search-btn { padding: 14px 32px; background: var(--primary); color: white; border: none; border-radius: 10px; font-size: 0.95rem; font-weight: 700; cursor: pointer; transition: all 0.2s; font-family: var(--fj); }
        .search-btn:hover { background: var(--primary-dark); transform: translateY(-1px); box-shadow: 0 4px 14px rgba(59,130,246,0.35); }

        /* ===== çµæœ ===== */
        .results-section { background: var(--surface); border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow); margin-bottom: 16px; }
        .results-header { padding: 16px 24px; border-bottom: 1px solid var(--border); background: var(--surface-dim); }
        .results-title { font-size: 1.05rem; font-weight: 700; }
        .results-subtitle { font-size: 0.8rem; color: var(--text-muted); margin-top: 2px; }

        /* ===== çµ„ã¿åˆã‚ã›ã‚«ãƒ¼ãƒ‰ ===== */
        .combination-card { padding: 20px 24px; border-bottom: 1px solid #f1f5f9; }
        .combination-card:last-child { border-bottom: none; }
        .combination-card.recommended { background: linear-gradient(135deg, #f0fdf4, #ecfdf5); border-left: 4px solid var(--success); }
        .combination-card.best-profit { background: linear-gradient(135deg, #fffbeb, #fef3c7); border: 2px solid #f59e0b; border-radius: var(--radius); margin: 16px; }
        .best-profit-label { display: inline-block; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 4px 12px; border-radius: 6px; font-size: 0.78rem; font-weight: 700; margin-bottom: 8px; }
        .combination-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 14px; flex-wrap: wrap; gap: 12px; }
        .combination-rank { display: flex; align-items: center; gap: 12px; }
        .rank-badge { width: 34px; height: 34px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.9rem; }
        .rank-badge.gold { background: linear-gradient(135deg, #fbbf24, #f59e0b); }
        .rank-badge.silver { background: linear-gradient(135deg, #94a3b8, #64748b); }
        .rank-badge.bronze { background: linear-gradient(135deg, #d97706, #b45309); }
        .combination-info h3 { font-size: 0.95rem; font-weight: 700; }
        .combination-info p { font-size: 0.8rem; color: var(--text-sub); }

        /* ===== stats ===== */
        .combination-stats { display: flex; gap: 8px; flex-wrap: wrap; }
        .stat-item { text-align: center; padding: 8px 14px; background: var(--surface-dim); border-radius: 10px; min-width: 90px; border: 1px solid var(--border); }
        .stat-value { font-size: 1.15rem; font-weight: 700; font-family: var(--fn); }
        .stat-value.positive { color: var(--success); }
        .stat-value.negative { color: var(--danger); }
        .stat-label { font-size: 0.68rem; color: var(--text-muted); margin-top: 1px; }

        /* ===== å•†å“è¡Œï¼ˆçµ„ã¿åˆã‚ã›å†…ã‚¢ã‚¤ãƒ†ãƒ ï¼‰===== */
        .combination-items { display: flex; flex-direction: column; gap: 6px; }
        .combo-item-adj {
            display: flex !important; justify-content: space-between; align-items: center;
            padding: 14px 16px; background: var(--surface-dim); border-radius: 10px;
            border: 1px solid var(--border); gap: 12px; transition: border-color 0.15s;
        }
        .combo-item-adj:hover { border-color: #cbd5e1; }
        .combo-item-left { flex: 1; min-width: 0; }
        .combo-item-left .combo-item-name { display: block; font-weight: 600; font-size: 0.9rem; color: var(--text); margin-bottom: 6px; }

        /* â˜… å®šä¾¡ãƒ»è²·å–ã®æ–°ãƒ‡ã‚¶ã‚¤ãƒ³ - price-tag â˜… */
        .combo-item-left .combo-item-price { display: flex; gap: 6px; align-items: center; flex-wrap: wrap; }
        .price-tag {
            display: inline-flex; align-items: center; gap: 4px;
            padding: 4px 10px; border-radius: 6px;
            font-size: 0.85rem; font-weight: 700; font-family: var(--fn);
            line-height: 1;
        }
        .price-tag.retail { background: #f1f5f9; color: #64748b; border: 1px solid #e2e8f0; }
        .price-tag.buyback { background: #dbeafe; color: #1d4ed8; border: 1px solid #bfdbfe; font-size: 0.9rem; }
        .price-tag.subtotal { background: #fef3c7; color: #92400e; border: 1px solid #fde68a; }
        .price-tag-label {
            font-size: 0.6rem; font-weight: 600; font-family: var(--fj);
            opacity: 0.7; letter-spacing: 0.02em;
        }
        .price-arrow { color: var(--text-muted); font-size: 0.75rem; font-weight: 500; }

        .combo-item-right { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }
        .combo-item-rate { padding: 5px 10px; border-radius: 8px; font-weight: 700; font-size: 0.85rem; min-width: 65px; text-align: center; font-family: var(--fn); }
        .combo-item-rate.high { background: #dcfce7; color: #15803d; }
        .combo-item-rate.medium { background: #fef9c3; color: #854d0e; }
        .combo-item-rate.low { background: #fee2e2; color: #b91c1c; }

        /* ===== å€‹æ•°èª¿æ•´ ===== */
        .qty-adj { display: flex; align-items: center; gap: 3px; }
        .qty-adj .qty-btn { width: 30px; height: 30px; border: 2px solid var(--border); background: white; border-radius: 8px; font-size: 1.1rem; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s; font-family: var(--fj); }
        .qty-adj .qty-btn:hover { border-color: #94a3b8; }
        .qty-adj .qty-btn.minus:hover { background: #fee2e2; color: #dc2626; border-color: #fca5a5; }
        .qty-adj .qty-btn.plus:hover { background: #dbeafe; color: #2563eb; border-color: #93c5fd; }
        .qty-adj .qty-value { width: 26px; text-align: center; font-weight: 700; font-size: 1rem; font-family: var(--fn); }
        .qty-value.has-items { color: var(--primary); }

        /* ===== ææ¡ˆã‚¨ãƒªã‚¢ ===== */
        .suggest-area { margin-top: 10px; }
        .suggest-header { font-size: 0.82rem; font-weight: 600; color: #92400e; background: #fffbeb; padding: 8px 16px; border-radius: 10px 10px 0 0; border: 1px solid #fcd34d; border-bottom: none; }
        .suggest-empty { font-size: 0.78rem; color: var(--text-muted); padding: 8px 16px; text-align: center; }
        .suggest-item { display: flex; align-items: center; gap: 10px; padding: 8px 16px; background: #fffef7; border-left: 1px solid #fcd34d; border-right: 1px solid #fcd34d; font-size: 0.82rem; }
        .suggest-item:last-child { border-bottom: 1px solid #fcd34d; border-radius: 0 0 10px 10px; }
        .suggest-item-info { flex: 1; min-width: 0; }
        .suggest-item-name { display: block; font-weight: 500; font-size: 0.78rem; }
        .suggest-item-price { display: block; font-size: 0.68rem; color: var(--text-muted); }
        .suggest-add-btn { padding: 5px 14px; background: #f59e0b; color: white; border: none; border-radius: 7px; font-size: 0.72rem; font-weight: 700; cursor: pointer; white-space: nowrap; transition: background 0.15s; font-family: var(--fj); }
        .suggest-add-btn:hover { background: #d97706; }
        .combo-item-adj.added-item { background: #fefce8; border: 1px dashed #fcd34d; }

        /* ===== å…¨å•†å“ä¸€è¦§ ===== */
        .products-section { background: var(--surface); border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow); }
        .section-header { padding: 16px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
        .section-title { font-size: 1.1rem; font-weight: 700; }
        .filters { display: flex; gap: 6px; flex-wrap: wrap; }
        .filter-btn { padding: 5px 12px; border: 2px solid var(--border); border-radius: 8px; background: white; cursor: pointer; font-size: 0.75rem; font-weight: 600; transition: all 0.2s; font-family: var(--fj); }
        .filter-btn:hover { border-color: var(--primary); color: var(--primary); }
        .filter-btn.active { background: var(--primary); border-color: var(--primary); color: white; }
        .products-list { padding: 0; }
        .product-item { display: flex; flex-direction: column; gap: 6px; padding: 14px 24px; border-bottom: 1px solid #f1f5f9; transition: background 0.15s; }
        .product-item:last-child { border-bottom: none; }
        .product-item:hover { background: var(--surface-dim); }
        .product-name { font-weight: 600; font-size: 0.88rem; display: flex; align-items: center; gap: 8px; }
        .product-meta { font-size: 0.72rem; color: var(--text-muted); margin-top: 2px; display: flex; align-items: center; gap: 6px; }
        .product-price-row { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }
        .product-profit { font-size: 0.78rem; font-weight: 700; font-family: var(--fn); margin-left: 2px; }
        .profit-plus { color: var(--success); }
        .profit-minus { color: var(--danger); }
        .product-rate { padding: 3px 10px; border-radius: 6px; font-weight: 700; font-size: 0.82rem; font-family: var(--fn); margin-left: auto; }
        .product-rate.excellent { background: #dcfce7; color: #15803d; }
        .product-rate.good { background: #dbeafe; color: #1e40af; }
        .product-rate.normal { background: #fef9c3; color: #854d0e; }
        .cat-label { font-size: 0.65rem; padding: 2px 7px; border-radius: 4px; font-weight: 600; }
        .cat-switch2 { background: #dbeafe; color: #1e40af; }
        .cat-switch { background: #fce7f3; color: #9d174d; }
        .cat-ps5 { background: #ede9fe; color: #6d28d9; }
        .cat-steam { background: #d1fae5; color: #065f46; }
        .cat-meta { background: #f3e8ff; color: #7c3aed; }
        .cat-other { background: #f1f5f9; color: #475569; }

        /* ===== çµæœãªã— ===== */
        .no-results { text-align: center; padding: 48px 20px; }
        .no-results-icon { font-size: 3rem; margin-bottom: 12px; }
        .tips-box { background: var(--surface-dim); border-radius: 10px; padding: 16px; margin-top: 16px; text-align: left; display: inline-block; }
        .tips-box h4 { margin-bottom: 6px; }
        .tips-box ul { padding-left: 18px; font-size: 0.85rem; color: var(--text-sub); }

        /* ===== æ‰‹å‹•ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º ===== */
        .manual-section { background: var(--surface); border-radius: var(--radius); padding: 24px 28px; box-shadow: var(--shadow); }
        .manual-desc { color: var(--text-muted); font-size: 0.82rem; margin-bottom: 14px; }
        .manual-category-filters { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 14px; }
        .manual-filter-btn { padding: 5px 11px; border: 1px solid var(--border); background: white; border-radius: 7px; font-size: 0.75rem; cursor: pointer; transition: all 0.2s; font-weight: 600; font-family: var(--fj); }
        .manual-filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .manual-product-row { display: flex; align-items: center; gap: 12px; padding: 11px 12px; border-bottom: 1px solid #f1f5f9; transition: background 0.15s; }
        .manual-product-row:hover { background: var(--surface-dim); }
        .manual-product-row.in-cart { background: #eff6ff; }
        .mp-info { flex: 1; min-width: 0; }
        .mp-name { font-weight: 600; font-size: 0.85rem; }
        .mp-prices-row { display: flex; gap: 5px; align-items: center; flex-wrap: wrap; margin-top: 4px; }
        .mp-meta { font-size: 0.72rem; color: var(--text-muted); margin-top: 2px; }
        .mp-prices { display: flex; gap: 8px; font-size: 0.78rem; flex-shrink: 0; align-items: center; }
        .mp-rate { font-weight: 700; min-width: 55px; text-align: right; font-family: var(--fn); }
        .mp-rate.excellent { color: #15803d; }
        .mp-rate.good { color: #2563eb; }
        .mp-rate.normal { color: var(--text-sub); }
        .mp-qty { display: flex; align-items: center; gap: 3px; flex-shrink: 0; }
        .qty-btn { width: 28px; height: 28px; border: 1.5px solid var(--border); background: white; border-radius: 7px; font-size: 1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s; font-family: var(--fj); }
        .qty-btn:hover { border-color: #94a3b8; }
        .qty-btn.minus:hover { background: #fee2e2; color: #dc2626; }
        .qty-btn.plus:hover { background: #dbeafe; color: #2563eb; }
        .qty-value { width: 30px; text-align: center; font-weight: 700; font-size: 0.95rem; font-family: var(--fn); }

        /* ===== ã‚«ãƒ¼ãƒˆåˆè¨ˆ ===== */
        .manual-summary { position: sticky; bottom: 0; background: white; border-radius: 12px; padding: 18px; margin-bottom: 18px; box-shadow: 0 -4px 16px rgba(0,0,0,0.08); border: 2px solid var(--primary); }
        .manual-summary h3 { font-size: 0.95rem; font-weight: 700; margin-bottom: 12px; }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; }
        .summary-item { text-align: center; padding: 8px; background: var(--surface-dim); border-radius: 8px; }
        .summary-value { font-size: 1.1rem; font-weight: 700; font-family: var(--fn); }
        .summary-label { font-size: 0.68rem; color: var(--text-muted); }
        .summary-bar { grid-column: 1 / -1; }
        .progress-track { height: 8px; background: #e2e8f0; border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); border-radius: 4px; transition: width 0.3s; }
        .progress-fill.over { background: var(--danger); }
        .progress-label { font-size: 0.72rem; color: var(--text-sub); margin-top: 4px; }
        .over-budget { color: var(--danger) !important; }

        /* ===== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===== */
        .loading { text-align: center; padding: 48px; color: var(--text-muted); }
        .loading-spinner { width: 36px; height: 36px; border: 3px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 12px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .footer { text-align: center; padding: 24px; color: #475569; font-size: 0.75rem; }
        .footer a { color: #94a3b8; }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ® ã‚²ãƒ¼ãƒ æ©Ÿ è²·å–ç‡ãƒˆãƒ©ãƒƒã‚«ãƒ¼</h1>
            <div class="header-meta">
                <span class="update-time" id="updateTime">èª­ã¿è¾¼ã¿ä¸­...</span>
                <span>ãƒ‡ãƒ¼ã‚¿å…ƒ: ãƒ¢ãƒã‚¤ãƒ«ä¸€ç•ª</span>
            </div>
        </header>

        <div class="tabs">
            <button class="tab-btn active" data-tab="search">ğŸ” ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</button>
            <button class="tab-btn" data-tab="manual">ğŸ›’ æ‰‹å‹•ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</button>
            <button class="tab-btn" data-tab="list">ğŸ“‹ å…¨å•†å“ä¸€è¦§</button>
        </div>

        <!-- ã‚¿ãƒ–1: ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ -->
        <div class="tab-content active" id="tab-search">
            <div class="search-section">
                <h2 class="search-title">ğŸ¯ ãƒã‚¤ãƒ³ãƒˆæ¶ˆåŒ–ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>
                <div class="search-form">
                    <div class="form-group">
                        <label class="form-label">æŒã£ã¦ã„ã‚‹ãƒã‚¤ãƒ³ãƒˆï¼ˆå††ç›¸å½“ï¼‰</label>
                        <input type="number" class="form-input" id="pointsInput" placeholder="50000" value="50000">
                        <span class="form-hint">ãƒ“ãƒƒã‚¯ã‚«ãƒ¡ãƒ©ãƒ»ãƒ¤ãƒãƒ€é›»æ©Ÿç­‰ã®ãƒã‚¤ãƒ³ãƒˆ</span>
                    </div>
                </div>
                <button class="search-btn" id="searchBtn">ğŸ” æœ€é©ãªçµ„ã¿åˆã‚ã›ã‚’æ¤œç´¢</button>
            </div>
            <div class="results-section" id="resultsSection" style="display: none;">
                <div id="bestProfitSection" style="display: none;">
                    <div class="results-header">
                        <h3 class="results-title">ğŸ† æœ€ã‚‚åˆ©ç›ŠãŒå‡ºã‚‹çµ„ã¿åˆã‚ã›</h3>
                        <p class="results-subtitle" id="bestProfitSubtitle">æ¡ä»¶ã«å¿œã˜ã¦æœ€é©åŒ–</p>
                    </div>
                    <div id="bestProfitResult"></div>
                </div>
                <div class="results-header" style="margin-top: 24px;">
                    <h3 class="results-title" id="resultsTitle">æ¤œç´¢çµæœ</h3>
                    <p class="results-subtitle" id="resultsSubtitle"></p>
                </div>
                <div id="resultsList"></div>
            </div>
        </div>

        <!-- ã‚¿ãƒ–2: æ‰‹å‹•ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º -->
        <div class="tab-content" id="tab-manual">
            <div class="manual-section">
                <h2 class="search-title">ğŸ›’ æ‰‹å‹•ã§çµ„ã¿åˆã‚ã›ã‚’ä½œæˆ</h2>
                <p class="manual-desc">å•†å“ã¨å€‹æ•°ã‚’é¸ã‚“ã§ã€è‡ªåˆ†ã ã‘ã®çµ„ã¿åˆã‚ã›ã‚’ä½œã‚Œã¾ã™</p>
                <div class="search-form" style="margin-bottom:16px;">
                    <div class="form-group">
                        <label class="form-label">æŒã£ã¦ã„ã‚‹ãƒã‚¤ãƒ³ãƒˆï¼ˆå††ç›¸å½“ï¼‰</label>
                        <input type="number" class="form-input" id="manualPointsInput" placeholder="50000" value="50000">
                    </div>
                </div>
                <div class="manual-summary" id="manualSummary" style="display: none;">
                    <h3>ğŸ“Š ã‚«ãƒ¼ãƒˆåˆè¨ˆ</h3>
                    <div class="summary-grid" id="summaryGrid"></div>
                </div>
                <div class="manual-category-filters">
                    <button class="manual-filter-btn active" data-mcat="all">ã™ã¹ã¦</button>
                    <button class="manual-filter-btn" data-mcat="switch2">Switch 2</button>
                    <button class="manual-filter-btn" data-mcat="switch">Switch</button>
                    <button class="manual-filter-btn" data-mcat="ps5">PS5</button>
                    <button class="manual-filter-btn" data-mcat="steam">Steam Deck</button>
                    <button class="manual-filter-btn" data-mcat="meta">Meta Quest</button>
                    <button class="manual-filter-btn" data-mcat="other">ãã®ä»–</button>
                </div>
                <div class="manual-products" id="manualProducts"></div>
            </div>
        </div>

        <!-- ã‚¿ãƒ–3: å…¨å•†å“ä¸€è¦§ -->
        <div class="tab-content" id="tab-list">
            <div class="products-section">
                <div class="section-header">
                    <h2 class="section-title">ğŸ“Š å…¨å•†å“ä¸€è¦§</h2>
                    <div class="filters">
                        <button class="filter-btn active" data-category="all">ã™ã¹ã¦</button>
                        <button class="filter-btn" data-category="switch2">Switch 2</button>
                        <button class="filter-btn" data-category="switch">Switch</button>
                        <button class="filter-btn" data-category="ps5">PS5</button>
                        <button class="filter-btn" data-category="steam">Steam Deck</button>
                        <button class="filter-btn" data-category="meta">Meta Quest</button>
                        <button class="filter-btn" data-category="other">ãã®ä»–</button>
                    </div>
                </div>
                <div class="products-list" id="productsList">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer">
            <p>ãƒ‡ãƒ¼ã‚¿å…ƒ: <a href="https://www.mobile-ichiban.com/Prod/2/01" target="_blank">ãƒ¢ãƒã‚¤ãƒ«ä¸€ç•ª</a> | 3æ™‚é–“ã”ã¨è‡ªå‹•æ›´æ–°</p>
            <p>Â© 2026 C-Creation</p>
        </footer>
    </div>

    <script>
        // ============================================
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        // ============================================
        let allProducts = [];
        let currentCategory = 'all';

        // ã‚«ãƒ†ã‚´ãƒªåˆ¤å®šï¼ˆgroupãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã§è‡ªå‹•åˆ†é¡ï¼‰
        function getCategory(product) {
            const g = product.group || '';
            if (g.startsWith('switch2_') || g.startsWith('joycon2_') || g.startsWith('microsd_')) return 'switch2';
            if (g.startsWith('switch_') || g.startsWith('procon_') || g.startsWith('joycon_') || g.startsWith('switch_acc')) return 'switch';
            if (g.startsWith('ps5_') || g.startsWith('ps_')) return 'ps5';
            if (g.startsWith('steam_')) return 'steam';
            if (g.startsWith('meta_')) return 'meta';
            // nameãƒ™ãƒ¼ã‚¹ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
            const n = product.name || '';
            if (n.includes('Switch 2') || n.includes('Joy-Con 2') || n.includes('for Nintendo Switch 2')) return 'switch2';
            if (n.includes('Switch')) return 'switch';
            if (n.includes('PlayStation') || n.includes('PS5') || n.includes('DualSense')) return 'ps5';
            if (n.includes('Steam Deck')) return 'steam';
            if (n.includes('Meta Quest') || n.includes('Quest')) return 'meta';
            return 'other';
        }

        // ============================================
        // åŸ‹ã‚è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ï¼ˆGitHub Actions ã§è‡ªå‹•æ›´æ–°ã•ã‚Œã‚‹éƒ¨åˆ†ï¼‰
        // å®šä¾¡ã¯å…¨ã¦ç¨è¾¼
        // group: åŒä¸€å•†å“ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆåŒã˜ã‚°ãƒ«ãƒ¼ãƒ—ã‹ã‚‰ã¯1ã¤ã—ã‹é¸ã¹ãªã„ï¼‰
        // ============================================
        const EMBEDDED_DATA = {
            "updated_at": "2026-02-01T12:00:00",
            "all_products": [
                {"jan": "4902370552683", "name": "Nintendo Switch 2 å¤šè¨€èªå¯¾å¿œç‰ˆ", "brand": "Nintendo", "official_price": 69980, "buyback_price": 85000, "rate": 121.46, "profit": 15020, "group": "switch2_main"},
                {"jan": "4902370553024", "name": "Nintendo Switch 2 å›½å†…ç‰ˆ", "brand": "Nintendo", "official_price": 49980, "buyback_price": 46300, "rate": 92.64, "profit": -3680, "group": "switch2_main"},
                {"jan": "4902370553031", "name": "Nintendo Switch 2 ãƒãƒªã‚ªã‚«ãƒ¼ãƒˆ ãƒ¯ãƒ¼ãƒ«ãƒ‰ ã‚»ãƒƒãƒˆ å›½å†…ç‰ˆ", "brand": "Nintendo", "official_price": 53980, "buyback_price": 51500, "rate": 95.42, "profit": -2480, "group": "switch2_main"},
                {"jan": "4902370553505", "name": "Nintendo Switch 2 Pokemon LEGENDS Z-A ã‚»ãƒƒãƒˆ å›½å†…ç‰ˆ", "brand": "Nintendo", "official_price": 53980, "buyback_price": 51000, "rate": 94.48, "profit": -2980, "group": "switch2_main"},
                {"jan": "4902370548501", "name": "Nintendo Switch (æœ‰æ©ŸELãƒ¢ãƒ‡ãƒ«) ãƒã‚ªãƒ³ãƒ–ãƒ«ãƒ¼ãƒ»ãƒã‚ªãƒ³ãƒ¬ãƒƒãƒ‰", "brand": "Nintendo", "official_price": 37980, "buyback_price": 40600, "rate": 106.90, "profit": 2620, "group": "switch_oled"},
                {"jan": "4902370548495", "name": "Nintendo Switch (æœ‰æ©ŸELãƒ¢ãƒ‡ãƒ«) ãƒ›ãƒ¯ã‚¤ãƒˆ", "brand": "Nintendo", "official_price": 37980, "buyback_price": 40600, "rate": 106.90, "profit": 2620, "group": "switch_oled"},
                {"jan": "4902370550733", "name": "Nintendo Switch Joy-Con(L) ãƒã‚ªãƒ³ãƒ–ãƒ«ãƒ¼/(R) ãƒã‚ªãƒ³ãƒ¬ãƒƒãƒ‰ æ–°å‹", "brand": "Nintendo", "official_price": 32978, "buyback_price": 32500, "rate": 98.55, "profit": -478, "group": "switch_standard"},
                {"jan": "4902370551198", "name": "Nintendo Switch Joy-Con(L)/(R) ã‚°ãƒ¬ãƒ¼ æ–°å‹", "brand": "Nintendo", "official_price": 32978, "buyback_price": 32500, "rate": 98.55, "profit": -478, "group": "switch_standard"},
                {"jan": "0814585022308", "name": "Steam Deck OLED 1TB", "brand": "Valve", "official_price": 99800, "buyback_price": 103800, "rate": 104.01, "profit": 4000, "group": "steam_deck"},
                {"jan": "4948872417075", "name": "PlayStation 5 Pro CFI-7100B01 2TB 2025ç‰ˆ", "brand": "Sony", "official_price": 119980, "buyback_price": 107200, "rate": 89.35, "profit": -12780, "group": "ps5_pro"},
                {"jan": "4948872415934", "name": "PlayStation 5 slim CFI-2000A01", "brand": "Sony", "official_price": 79980, "buyback_price": 74700, "rate": 93.40, "profit": -5280, "group": "ps5_slim"},
                {"jan": "4902370552843", "name": "Nintendo Switch 2 Proã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼", "brand": "Nintendo", "official_price": 9980, "buyback_price": 8400, "rate": 84.17, "profit": -1580, "group": "switch2_procon"},
                {"jan": "4902370552744", "name": "Joy-Con 2 (L)/(R) ãƒ©ã‚¤ãƒˆãƒ–ãƒ«ãƒ¼/ãƒ©ã‚¤ãƒˆãƒ¬ãƒƒãƒ‰", "brand": "Nintendo", "official_price": 9980, "buyback_price": 8600, "rate": 86.17, "profit": -1380, "group": "joycon2_pair"},
                {"jan": "4902370552911", "name": "Nintendo Switch 2 ãƒ‰ãƒƒã‚¯ã‚»ãƒƒãƒˆ", "brand": "Nintendo", "official_price": 12980, "buyback_price": 11200, "rate": 86.29, "profit": -1780, "group": "switch2_dock"},
                {"jan": "0815820025238", "name": "Meta Quest 3S 128GB", "brand": "Meta", "official_price": 48400, "buyback_price": 38600, "rate": 79.75, "profit": -9800, "group": "meta_quest3s"},
                {"jan": "4902370552706", "name": "Joy-Con 2 (L) ãƒ©ã‚¤ãƒˆãƒ–ãƒ«ãƒ¼", "brand": "Nintendo", "official_price": 4480, "buyback_price": 3500, "rate": 78.13, "profit": -980, "group": "joycon2_left"},
                {"jan": "4902370552720", "name": "Joy-Con 2 (R) ãƒ©ã‚¤ãƒˆãƒ¬ãƒƒãƒ‰", "brand": "Nintendo", "official_price": 4480, "buyback_price": 3500, "rate": 78.13, "profit": -980, "group": "joycon2_right"},
                {"jan": "4523052030185", "name": "SanDisk microSD Express Card 256GB for Nintendo Switch 2", "brand": "SanDisk", "official_price": 7480, "buyback_price": 5800, "rate": 77.54, "profit": -1680, "group": "microsd_256"},
                {"jan": "8806095700670", "name": "Samsung microSD Express Card 256GB for Nintendo Switch 2", "brand": "Samsung", "official_price": 7480, "buyback_price": 5800, "rate": 77.54, "profit": -1680, "group": "microsd_256"}
            ]
        };

        // ============================================
        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        // ============================================
        async function loadData() {
            try {
                // ã¾ãšå¤–éƒ¨JSONã‚’è©¦ã™ï¼ˆGitHub Pagesç”¨ï¼‰
                const response = await fetch('data/prices.json');
                if (response.ok) {
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('application/json')) {
                        const data = await response.json();
                        allProducts = data.all_products || [];
                        const updateTime = new Date(data.updated_at);
                        document.getElementById('updateTime').textContent = 
                            `æœ€çµ‚æ›´æ–°: ${updateTime.toLocaleString('ja-JP')}`;
                        renderProducts();
                        renderManualProducts();
                        return;
                    }
                }
            } catch (error) {
                console.log('å¤–éƒ¨JSONèª­ã¿è¾¼ã¿å¤±æ•—ã€åŸ‹ã‚è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨');
            }
            
            // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šåŸ‹ã‚è¾¼ã¿ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
            allProducts = EMBEDDED_DATA.all_products || [];
            const updateTime = new Date(EMBEDDED_DATA.updated_at);
            document.getElementById('updateTime').textContent = 
                `æœ€çµ‚æ›´æ–°: ${updateTime.toLocaleString('ja-JP')}`;
            renderProducts();
            renderManualProducts();
        }

        // ============================================
        // ============================================
        // çµ„ã¿åˆã‚ã›æ¤œç´¢ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
        // æ®µéšçš„ã«æ¡ä»¶ã‚’ç·©å’Œã—ã¦å¿…ãšçµæœã‚’å‡ºã™
        // ============================================
        function findCombinations(points) {
            // ãƒã‚¤ãƒ³ãƒˆé¡ã«å¿œã˜ãŸå€‹æ•°ä¸Šé™
            let MAX_TOTAL;
            if (points <= 50000) MAX_TOTAL = 5;
            else if (points <= 100000) MAX_TOTAL = 7;
            else if (points <= 200000) MAX_TOTAL = 10;
            else MAX_TOTAL = 15;

            // å€™è£œ: è²·å–ç‡90%ä»¥ä¸Š & ã‚°ãƒ«ãƒ¼ãƒ—ä»£è¡¨
            const candidates = [...allProducts].filter(p => p.rate >= 90).sort((a, b) => b.rate - a.rate);
            const grouped = [];
            const seenGroups = new Set();
            for (const p of candidates) {
                if (p.group) {
                    if (seenGroups.has(p.group)) continue;
                    seenGroups.add(p.group);
                }
                grouped.push(p);
            }

            function maxQtyFor(p, slots) {
                return Math.min(p.official_price >= 30000 ? 1 : 3, slots);
            }

            function buildResult(cart) {
                let tp = 0, tb = 0, tc = 0;
                const items = [];
                for (const [jan, info] of Object.entries(cart)) {
                    tp += info.product.official_price * info.qty;
                    tb += info.product.buyback_price * info.qty;
                    tc += info.qty;
                    items.push({ ...info.product, qty: info.qty });
                }
                if (tc === 0 || tp === 0 || tp > points) return null;
                return {
                    items, itemCount: tc, totalPrice: tp, totalBuyback: tb,
                    avgRate: Math.round((tb / tp) * 10000) / 100,
                    cashOut: 0, profit: tb - tp, pointsUsed: tp,
                    pointsRemaining: points - tp,
                    utilizationRate: Math.round((tp / points) * 10000) / 100
                };
            }

            // ============ Greedyæ³• ============
            function greedyFill(mainList, maxTotal) {
                const cart = {};
                let remaining = points, count = 0;
                
                // ãƒ‘ã‚¹1: ãƒ¡ã‚¤ãƒ³æˆ¦ç•¥ã§è©°ã‚ã‚‹
                for (const p of mainList) {
                    if (count >= maxTotal || remaining <= 0) break;
                    if (p.official_price > remaining) continue;
                    const maxQ = Math.min(
                        p.official_price >= 30000 ? 1 : 3,
                        maxTotal - count,
                        Math.floor(remaining / p.official_price)
                    );
                    if (maxQ <= 0) continue;
                    cart[p.jan] = { product: p, qty: maxQ };
                    remaining -= p.official_price * maxQ;
                    count += maxQ;
                }
                
                // ãƒ‘ã‚¹2: æ®‹é¡ã‚’å…¨å•†å“ã‹ã‚‰åŸ‹ã‚ã‚‹ï¼ˆé«˜é¡â†’å®‰ã„é †ã§æœ€å¤§é™è©°ã‚ã‚‹ï¼‰
                // æ®‹é¡åŸ‹ã‚ã¯rateæ¡ä»¶ãªã—ï¼ˆæ¶ˆåŒ–ç‡å‘ä¸ŠãŒç›®çš„ï¼‰
                const allByPrice = [...allProducts].sort((a, b) => b.official_price - a.official_price);
                for (const p of allByPrice) {
                    if (count >= maxTotal || remaining <= 0) break;
                    if (p.official_price > remaining) continue;
                    
                    if (cart[p.jan]) {
                        // æ—¢ã«ã‚«ãƒ¼ãƒˆã«ã‚ã‚‹ â†’ å€‹æ•°è¿½åŠ å¯èƒ½ã‹
                        const info = cart[p.jan];
                        if (info.product.official_price >= 30000) continue;
                        const canAdd = Math.min(3 - info.qty, maxTotal - count, Math.floor(remaining / p.official_price));
                        if (canAdd <= 0) continue;
                        info.qty += canAdd;
                        remaining -= p.official_price * canAdd;
                        count += canAdd;
                    } else {
                        const maxQ = Math.min(
                            p.official_price >= 30000 ? 1 : 3,
                            maxTotal - count,
                            Math.floor(remaining / p.official_price)
                        );
                        if (maxQ <= 0) continue;
                        cart[p.jan] = { product: p, qty: maxQ };
                        remaining -= p.official_price * maxQ;
                        count += maxQ;
                    }
                }
                
                return buildResult(cart);
            }

            // 5ã¤ã®ã‚½ãƒ¼ãƒˆæˆ¦ç•¥ï¼ˆgroupedã¯rate90ä»¥ä¸Šã€allSortedã¯å…¨å•†å“ï¼‰
            const allSorted = [...allProducts].sort((a, b) => b.official_price - a.official_price);
            const strategies = [
                allSorted, // å…¨å•†å“é«˜é¡é †ï¼ˆæ¶ˆåŒ–ç‡æœ€å¤§åŒ–ï¼‰
                [...grouped].sort((a, b) => b.official_price - a.official_price),
                [...grouped].sort((a, b) => (b.buyback_price - b.official_price) - (a.buyback_price - a.official_price)),
                grouped,
                [...grouped].sort((a, b) => ((b.buyback_price - b.official_price) / b.official_price) - ((a.buyback_price - a.official_price) / a.official_price))
            ];

            const allResults = [];
            
            // å€‹æ•°ä¸Šé™ã‚’æ®µéšçš„ã«ä¸Šã’ãªãŒã‚‰è©¦ã™
            for (const mt of [MAX_TOTAL, MAX_TOTAL + 3, MAX_TOTAL + 6]) {
                for (const list of strategies) {
                    const r = greedyFill(list, mt);
                    if (r) allResults.push(r);
                }
            }

            // ============ æ¢ç´¢æ³•ï¼ˆ2ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰ ============
            const minPrice = points * 0.98;
            const SEARCH_LIMIT = 500;
            const startTime = Date.now();

            function search(idx, cart, totalPrice, totalBuyback, totalCount) {
                if (Date.now() - startTime > 2000) return;
                if (allResults.length >= SEARCH_LIMIT) return;
                if (totalCount >= MAX_TOTAL) return;

                if (totalCount > 0 && totalPrice >= minPrice && totalPrice <= points) {
                    const avgRate = (totalBuyback / totalPrice) * 100;
                    if (avgRate >= 95) {
                        const items = [];
                        for (const [jan, info] of Object.entries(cart)) {
                            items.push({ ...info.product, qty: info.qty });
                        }
                        allResults.push({
                            items, itemCount: totalCount, totalPrice, totalBuyback,
                            avgRate: Math.round(avgRate * 100) / 100, cashOut: 0,
                            profit: totalBuyback - totalPrice, pointsUsed: totalPrice,
                            pointsRemaining: points - totalPrice,
                            utilizationRate: Math.round((totalPrice / points) * 10000) / 100
                        });
                    }
                }

                for (let i = idx; i < grouped.length; i++) {
                    const p = grouped[i];
                    const mq = maxQtyFor(p, MAX_TOTAL - totalCount);
                    for (let q = 1; q <= mq; q++) {
                        const newPrice = totalPrice + p.official_price * q;
                        if (newPrice > points) break;
                        cart[p.jan] = { product: p, qty: q };
                        search(i + 1, cart, newPrice, totalBuyback + p.buyback_price * q, totalCount + q);
                        if (allResults.length >= SEARCH_LIMIT || Date.now() - startTime > 2000) {
                            delete cart[p.jan]; return;
                        }
                    }
                    delete cart[p.jan];
                }
            }

            search(0, {}, 0, 0, 0);

            // ============ é‡è¤‡é™¤å» ============
            const uniqueMap = new Map();
            for (const r of allResults) {
                const key = r.items.map(i => `${i.jan}x${i.qty}`).sort().join(',');
                if (!uniqueMap.has(key) || r.profit > uniqueMap.get(key).profit) {
                    uniqueMap.set(key, r);
                }
            }
            let unique = [...uniqueMap.values()];

            // æ¶ˆåŒ–ç‡ãŒé«˜ã„çµæœã‚’å„ªå…ˆï¼ˆæ®µéšçš„ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼‰
            for (const minUtil of [98, 95, 90, 0]) {
                const filtered = unique.filter(r => r.utilizationRate >= minUtil);
                if (filtered.length > 0) { unique = filtered; break; }
            }

            // ã‚½ãƒ¼ãƒˆ: æ¶ˆåŒ–ç‡é«˜ã„ â†’ åˆ©ç›ŠåŠ¹ç‡ â†’ å€‹æ•°å°‘ãªã„
            unique.sort((a, b) => {
                if (Math.abs(b.utilizationRate - a.utilizationRate) > 2) return b.utilizationRate - a.utilizationRate;
                const effA = a.profit / a.itemCount;
                const effB = b.profit / b.itemCount;
                if (Math.abs(effB - effA) > 10) return effB - effA;
                if (a.itemCount !== b.itemCount) return a.itemCount - b.itemCount;
                return b.profit - a.profit;
            });

            return unique.slice(0, 15);
        }



        // ============================================
        // æ¤œç´¢å®Ÿè¡Œ
        // ============================================
        function executeSearch() {
            const points = parseInt(document.getElementById('pointsInput').value) || 50000;
            
            const results = findCombinations(points);
            
            // æœ€é«˜åˆ©ç›Šã®çµ„ã¿åˆã‚ã›ã‚’æ¢ã™ï¼ˆæ¶ˆåŒ–ç‡98%ä»¥ä¸Šã®ã¿ï¼‰
            let bestProfit = null;
            for (const r of results) {
                if (r.utilizationRate < 98) continue;
                if (!bestProfit || r.profit > bestProfit.profit) {
                    bestProfit = r;
                }
            }
            // 98%ä»¥ä¸ŠãŒãªã‘ã‚Œã°ã€æ¶ˆåŒ–ç‡90%ä»¥ä¸Šã§æœ€ã‚‚é«˜ã„åˆ©ç›Šã®ã‚‚ã®ã‚’æ¡ç”¨
            if (!bestProfit && results.length > 0) {
                const viable = results.filter(r => r.utilizationRate >= 90);
                if (viable.length > 0) {
                    bestProfit = viable.reduce((best, r) => 
                        !best || r.profit > best.profit ? r : best, null);
                }
            }
            
            // è²·å–ç‡é †ï¼ˆä¸Šä½15ä»¶ï¼‰
            const byRate = results.slice(0, 15);
            
            renderResults(byRate, bestProfit, points);
            
            // å€‹æ•°ä¸Šé™ã‚’ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ã«åæ˜ 
            let maxT = points <= 50000 ? 5 : points <= 100000 ? 7 : points <= 200000 ? 10 : 15;
            const bpSub = document.getElementById('bestProfitSubtitle');
            if (bpSub) bpSub.textContent = `${maxT}å€‹ä»¥å†… Ã— æ¶ˆåŒ–ç‡98%â†‘ Ã— è²·å–ç‡95%â†‘ Ã— åˆ©ç›Šæœ€å¤§`;
        }

        // ============================================
        // æ¤œç´¢çµæœè¡¨ç¤º
        // ============================================
        function renderResults(results, bestProfit, points) {
            const section = document.getElementById('resultsSection');
            const list = document.getElementById('resultsList');
            const title = document.getElementById('resultsTitle');
            const subtitle = document.getElementById('resultsSubtitle');
            const bpSection = document.getElementById('bestProfitSection');
            const bpResult = document.getElementById('bestProfitResult');
            
            section.style.display = 'block';
            
            // æœ€é«˜åˆ©ç›Šã‚»ã‚¯ã‚·ãƒ§ãƒ³
            if (bestProfit) {
                bpSection.style.display = 'block';
                const bpId = 'bp';
                // å€‹æ•°çŠ¶æ…‹ã‚’ä¿å­˜
                window._cardQty = window._cardQty || {};
                window._cardQty[bpId] = {};
                window._cardItems[bpId] = bestProfit.items;
                bestProfit.items.forEach(item => { window._cardQty[bpId][item.jan] = item.qty || 1; });
                
                const profitClass = bestProfit.profit >= 0 ? 'positive' : 'negative';
                const profitSign = bestProfit.profit >= 0 ? '+' : '';
                bpResult.innerHTML = `
                    <div class="combination-card best-profit" id="card-${bpId}">
                        <div class="best-profit-label">ğŸ’° æœ€é«˜åˆ©ç›Š</div>
                        <div class="combination-header">
                            <div class="combination-rank">
                                <div class="rank-badge gold">ğŸ‘‘</div>
                                <div class="combination-info">
                                    <h3 id="card-${bpId}-title">${bestProfit.itemCount}ç‚¹ã®çµ„ã¿åˆã‚ã›</h3>
                                    <p id="card-${bpId}-desc">ãƒã‚¤ãƒ³ãƒˆ ${bestProfit.pointsUsed.toLocaleString()}å††ä½¿ç”¨ï¼ˆæ¶ˆåŒ–ç‡ ${bestProfit.utilizationRate}%ï¼‰â†’ æ®‹ã‚Š ${bestProfit.pointsRemaining.toLocaleString()}å††</p>
                                </div>
                            </div>
                            <div class="combination-stats" id="card-${bpId}-stats">
                                <div class="stat-item">
                                    <div class="stat-value ${profitClass}" style="font-size:1.3rem">${profitSign}Â¥${bestProfit.profit.toLocaleString()}</div>
                                    <div class="stat-label">åˆ©ç›Š</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${bestProfit.itemCount}å€‹</div>
                                    <div class="stat-label">å€‹æ•°</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">Â¥${bestProfit.totalBuyback.toLocaleString()}</div>
                                    <div class="stat-label">åˆè¨ˆè²·å–</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${bestProfit.avgRate}%</div>
                                    <div class="stat-label">å¹³å‡è²·å–ç‡</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${bestProfit.utilizationRate}%</div>
                                    <div class="stat-label">æ¶ˆåŒ–ç‡</div>
                                </div>
                            </div>
                        </div>
                        <div class="combination-items">
                            ${bestProfit.items.map(item => {
                                const rateClass = item.rate >= 100 ? 'high' : item.rate >= 95 ? 'medium' : 'low';
                                const qty = item.qty || 1;
                                const subtotalPrice = item.official_price * qty;
                                const subtotalBuyback = item.buyback_price * qty;
                                const priceHtml = qty > 1
                                    ? `<span class="price-tag subtotal"><span class="price-tag-label">å®šä¾¡</span>Â¥${item.official_price.toLocaleString()} Ã—${qty}</span><span class="price-arrow">â†’</span><span class="price-tag buyback"><span class="price-tag-label">è²·å–</span>Â¥${subtotalBuyback.toLocaleString()}</span>`
                                    : `<span class="price-tag retail"><span class="price-tag-label">å®šä¾¡</span>Â¥${item.official_price.toLocaleString()}</span><span class="price-arrow">â†’</span><span class="price-tag buyback"><span class="price-tag-label">è²·å–</span>Â¥${item.buyback_price.toLocaleString()}</span>`;
                                return `
                                    <div class="combo-item-adj">
                                        <div class="combo-item-left">
                                            <span class="combo-item-name">${escapeHtml(item.name)}</span>
                                            <div class="combo-item-price">${priceHtml}</div>
                                        </div>
                                        <div class="combo-item-right">
                                            <span class="combo-item-rate ${rateClass}">${item.rate}%</span>
                                            <div class="qty-adj">
                                                <button class="qty-btn minus" onclick="adjustCardQty('${bpId}','${item.jan}',-1)">âˆ’</button>
                                                <span class="qty-value has-items" id="qty-${bpId}-${item.jan}">${qty}</span>
                                                <button class="qty-btn plus" onclick="adjustCardQty('${bpId}','${item.jan}',1)">ï¼‹</button>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        <div class="suggest-area" id="suggest-${bpId}"></div>
                    </div>
                `;
            } else {
                bpSection.style.display = 'none';
            }
            
            // è²·å–ç‡é †ã‚»ã‚¯ã‚·ãƒ§ãƒ³
            title.textContent = `ğŸ“Š ãŠã™ã™ã‚çµ„ã¿åˆã‚ã› ï¼ˆ${results.length}ä»¶ï¼‰`;
            subtitle.textContent = `ãƒã‚¤ãƒ³ãƒˆ ${points.toLocaleString()}å†† / è²·å–ç‡95%â†‘ / åˆ©ç›ŠåŠ¹ç‡é †`;
            
            if (results.length === 0) {
                list.innerHTML = `
                    <div class="no-results">
                        <div class="no-results-icon">ğŸ˜¢</div>
                        <p>æ¡ä»¶ã«åˆã†çµ„ã¿åˆã‚ã›ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>
                        <div class="tips-box">
                            <h4>ğŸ’¡ ãƒ’ãƒ³ãƒˆ</h4>
                            <ul>
                                <li>ãƒã‚¤ãƒ³ãƒˆé¡ã‚’èª¿æ•´ã—ã¦ã¿ã¦ãã ã•ã„</li>
                                <li>æ‰‹å‹•ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§è‡ªç”±ã«çµ„ã¿åˆã‚ã›ã‚’è©¦ã›ã¾ã™</li>
                            </ul>
                        </div>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = results.map((combo, index) => {
                const cardId = 'r' + index;
                window._cardQty[cardId] = {};
                window._cardItems[cardId] = combo.items;
                combo.items.forEach(item => { window._cardQty[cardId][item.jan] = item.qty || 1; });
                
                const rankClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
                const isRecommended = index === 0;
                const profitClass = combo.profit >= 0 ? 'positive' : 'negative';
                const profitSign = combo.profit >= 0 ? '+' : '';
                
                return `
                    <div class="combination-card ${isRecommended ? 'recommended' : ''}" id="card-${cardId}">
                        <div class="combination-header">
                            <div class="combination-rank">
                                <div class="rank-badge ${rankClass}">${index + 1}</div>
                                <div class="combination-info">
                                    <h3 id="card-${cardId}-title">${combo.itemCount}ç‚¹ã®çµ„ã¿åˆã‚ã› ${isRecommended ? 'â­ ãŠã™ã™ã‚' : ''}</h3>
                                    <p id="card-${cardId}-desc">ãƒã‚¤ãƒ³ãƒˆ ${combo.pointsUsed.toLocaleString()}å††ä½¿ç”¨ï¼ˆæ¶ˆåŒ–ç‡ ${combo.utilizationRate}%ï¼‰â†’ æ®‹ã‚Š ${combo.pointsRemaining.toLocaleString()}å††</p>
                                </div>
                            </div>
                            <div class="combination-stats" id="card-${cardId}-stats">
                                <div class="stat-item">
                                    <div class="stat-value ${profitClass}">${profitSign}Â¥${combo.profit.toLocaleString()}</div>
                                    <div class="stat-label">æç›Š</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${combo.itemCount}å€‹</div>
                                    <div class="stat-label">å€‹æ•°</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${combo.avgRate}%</div>
                                    <div class="stat-label">å¹³å‡è²·å–ç‡</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">Â¥${combo.totalBuyback.toLocaleString()}</div>
                                    <div class="stat-label">åˆè¨ˆè²·å–</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-value">${combo.utilizationRate}%</div>
                                    <div class="stat-label">æ¶ˆåŒ–ç‡</div>
                                </div>
                            </div>
                        </div>
                        <div class="combination-items">
                            ${combo.items.map(item => {
                                const rateClass = item.rate >= 100 ? 'high' : item.rate >= 95 ? 'medium' : 'low';
                                const qty = item.qty || 1;
                                const subtotalPrice = item.official_price * qty;
                                const subtotalBuyback = item.buyback_price * qty;
                                const priceHtml = qty > 1
                                    ? `<span class="price-tag subtotal"><span class="price-tag-label">å®šä¾¡</span>Â¥${item.official_price.toLocaleString()} Ã—${qty}</span><span class="price-arrow">â†’</span><span class="price-tag buyback"><span class="price-tag-label">è²·å–</span>Â¥${subtotalBuyback.toLocaleString()}</span>`
                                    : `<span class="price-tag retail"><span class="price-tag-label">å®šä¾¡</span>Â¥${item.official_price.toLocaleString()}</span><span class="price-arrow">â†’</span><span class="price-tag buyback"><span class="price-tag-label">è²·å–</span>Â¥${item.buyback_price.toLocaleString()}</span>`;
                                return `
                                    <div class="combo-item-adj">
                                        <div class="combo-item-left">
                                            <span class="combo-item-name">${escapeHtml(item.name)}</span>
                                            <div class="combo-item-price">${priceHtml}</div>
                                        </div>
                                        <div class="combo-item-right">
                                            <span class="combo-item-rate ${rateClass}">${item.rate}%</span>
                                            <div class="qty-adj">
                                                <button class="qty-btn minus" onclick="adjustCardQty('${cardId}','${item.jan}',-1)">âˆ’</button>
                                                <span class="qty-value has-items" id="qty-${cardId}-${item.jan}">${qty}</span>
                                                <button class="qty-btn plus" onclick="adjustCardQty('${cardId}','${item.jan}',1)">ï¼‹</button>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        <div class="suggest-area" id="suggest-${cardId}"></div>
                    </div>
                `;
            }).join('');
        }

        // ============================================
        // ã‚«ãƒ¼ãƒ‰å†… å€‹æ•°èª¿æ•´
        // ============================================
        // _cardItems: cardId â†’ [{jan, official_price, buyback_price, rate, name}]
        window._cardItems = {};
        window._cardQty = {};

        function adjustCardQty(cardId, jan, delta) {
            const qty = window._cardQty[cardId] || {};
            const current = qty[jan] || 0;
            const newQty = Math.max(0, current + delta);
            qty[jan] = newQty;
            window._cardQty[cardId] = qty;

            // æ•°å­—è¡¨ç¤ºæ›´æ–°
            const el = document.getElementById(`qty-${cardId}-${jan}`);
            if (el) {
                el.textContent = newQty;
                el.className = 'qty-value' + (newQty > 0 ? ' has-items' : '');
            }

            // åˆè¨ˆå†è¨ˆç®—
            recalcCard(cardId);
        }

        function recalcCard(cardId) {
            const qty = window._cardQty[cardId] || {};
            const items = window._cardItems[cardId] || [];
            const points = parseInt(document.getElementById('pointsInput').value) || 50000;

            let totalPrice = 0, totalBuyback = 0, totalCount = 0;
            for (const item of items) {
                const q = qty[item.jan] || 0;
                totalPrice += item.official_price * q;
                totalBuyback += item.buyback_price * q;
                totalCount += q;
            }

            const avgRate = totalPrice > 0 ? Math.round((totalBuyback / totalPrice) * 10000) / 100 : 0;
            const profit = totalBuyback - totalPrice;
            const pointsUsed = Math.min(totalPrice, points);
            const cashOut = Math.max(0, totalPrice - points);
            const remaining = Math.max(0, points - totalPrice);
            const utilization = totalPrice > 0 ? Math.round((Math.min(totalPrice, points) / points) * 10000) / 100 : 0;

            const profitClass = profit >= 0 ? 'positive' : 'negative';
            const profitSign = profit >= 0 ? '+' : '';

            // titleæ›´æ–°
            const titleEl = document.getElementById(`card-${cardId}-title`);
            if (titleEl) {
                const base = titleEl.textContent.replace(/\d+ç‚¹/, totalCount + 'ç‚¹');
                titleEl.textContent = totalCount > 0 ? base : '0ç‚¹ã®çµ„ã¿åˆã‚ã›';
            }

            // descæ›´æ–°
            const descEl = document.getElementById(`card-${cardId}-desc`);
            if (descEl) {
                if (totalCount === 0) {
                    descEl.textContent = 'å•†å“ã‚’è¿½åŠ ã—ã¦ãã ã•ã„';
                } else {
                    descEl.textContent = `ãƒã‚¤ãƒ³ãƒˆ ${pointsUsed.toLocaleString()}å††ä½¿ç”¨ï¼ˆæ¶ˆåŒ–ç‡ ${utilization}%ï¼‰â†’ æ®‹ã‚Š ${remaining.toLocaleString()}å††${cashOut > 0 ? ' âš ï¸ æ‰‹å‡ºã— Â¥' + cashOut.toLocaleString() : ''}`;
                }
            }

            // statsæ›´æ–°
            const statsEl = document.getElementById(`card-${cardId}-stats`);
            if (statsEl) {
                const isBp = cardId === 'bp';
                if (isBp) {
                    statsEl.innerHTML = `
                        <div class="stat-item">
                            <div class="stat-value ${profitClass}" style="font-size:1.3rem">${profitSign}Â¥${profit.toLocaleString()}</div>
                            <div class="stat-label">åˆ©ç›Š</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${totalCount}å€‹</div>
                            <div class="stat-label">å€‹æ•°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">Â¥${totalBuyback.toLocaleString()}</div>
                            <div class="stat-label">åˆè¨ˆè²·å–</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${avgRate}%</div>
                            <div class="stat-label">å¹³å‡è²·å–ç‡</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${utilization}%</div>
                            <div class="stat-label">æ¶ˆåŒ–ç‡</div>
                        </div>
                    `;
                } else {
                    statsEl.innerHTML = `
                        <div class="stat-item">
                            <div class="stat-value ${profitClass}">${profitSign}Â¥${profit.toLocaleString()}</div>
                            <div class="stat-label">æç›Š</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${totalCount}å€‹</div>
                            <div class="stat-label">å€‹æ•°</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${avgRate}%</div>
                            <div class="stat-label">å¹³å‡è²·å–ç‡</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">Â¥${totalBuyback.toLocaleString()}</div>
                            <div class="stat-label">åˆè¨ˆè²·å–</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${utilization}%</div>
                            <div class="stat-label">æ¶ˆåŒ–ç‡</div>
                        </div>
                    `;
                }
            }

            // ææ¡ˆ: ä½™ã£ãŸãƒã‚¤ãƒ³ãƒˆã§è¿½åŠ ã§ãã‚‹å•†å“ã‚’è¡¨ç¤º
            showSuggestions(cardId, remaining, qty, items, totalPrice, totalBuyback);
        }

        function showSuggestions(cardId, remaining, currentQty, currentItems, currentTotalPrice, currentTotalBuyback) {
            const suggestEl = document.getElementById(`suggest-${cardId}`);
            if (!suggestEl) return;

            if (remaining < 500) {
                suggestEl.innerHTML = '';
                return;
            }

            const usedGroups = new Set();
            for (const item of currentItems) {
                if ((currentQty[item.jan] || 0) > 0 && item.group) {
                    usedGroups.add(item.group);
                }
            }

            // è¿½åŠ å¾Œã«å…¨ä½“å¹³å‡95%ä»¥ä¸Šã‚’ç¶­æŒã§ãã‚‹å•†å“ã®ã¿
            const candidates = allProducts
                .filter(p => {
                    if (p.rate < 90) return false;
                    if (p.official_price > remaining) return false;
                    if (p.group && usedGroups.has(p.group)) return false;
                    // è¿½åŠ å¾Œã®å…¨ä½“å¹³å‡è²·å–ç‡ãƒã‚§ãƒƒã‚¯
                    const newTotalPrice = currentTotalPrice + p.official_price;
                    const newTotalBuyback = currentTotalBuyback + p.buyback_price;
                    const newAvgRate = (newTotalBuyback / newTotalPrice) * 100;
                    if (newAvgRate < 95) return false;
                    return true;
                })
                .sort((a, b) => b.rate - a.rate)
                .slice(0, 5);

            if (candidates.length === 0) {
                suggestEl.innerHTML = `
                    <div class="suggest-empty">
                        æ®‹ã‚Š Â¥${remaining.toLocaleString()} ã§è¿½åŠ ã§ãã‚‹å•†å“ã¯ã‚ã‚Šã¾ã›ã‚“
                    </div>
                `;
                return;
            }

            suggestEl.innerHTML = `
                <div class="suggest-header">
                    ğŸ’¡ æ®‹ã‚Š Â¥${remaining.toLocaleString()} ã§è¿½åŠ ã§ãã‚‹å•†å“ï¼ˆè¿½åŠ å¾Œã‚‚å…¨ä½“95%ä»¥ä¸Šï¼‰
                </div>
                ${candidates.map(p => {
                    const rateClass = p.rate >= 100 ? 'high' : p.rate >= 95 ? 'medium' : 'low';
                    const simPrice = currentTotalPrice + p.official_price;
                    const simBuyback = currentTotalBuyback + p.buyback_price;
                    const simRate = Math.round((simBuyback / simPrice) * 10000) / 100;
                    return `
                        <div class="suggest-item">
                            <div class="suggest-item-info">
                                <span class="suggest-item-name">${escapeHtml(p.name)}</span>
                                <span class="suggest-item-price">Â¥${p.official_price.toLocaleString()} â†’ è²·å– Â¥${p.buyback_price.toLocaleString()}ã€€è¿½åŠ å¾Œå¹³å‡: ${simRate}%</span>
                            </div>
                            <span class="combo-item-rate ${rateClass}">${p.rate}%</span>
                            <button class="suggest-add-btn" onclick="addSuggestion('${cardId}','${p.jan}')">ï¼‹è¿½åŠ </button>
                        </div>
                    `;
                }).join('')}
            `;
        }

        function addSuggestion(cardId, jan) {
            const items = window._cardItems[cardId] || [];
            const product = allProducts.find(p => p.jan === jan);
            if (!product) return;

            if (!items.find(i => i.jan === jan)) {
                items.push(product);
                window._cardItems[cardId] = items;

                const container = document.getElementById(`card-${cardId}`);
                if (container) {
                    const itemsDiv = container.querySelector('.combination-items');
                    if (itemsDiv) {
                        const rateClass = product.rate >= 100 ? 'high' : product.rate >= 95 ? 'medium' : 'low';
                        const row = document.createElement('div');
                        row.className = 'combo-item-adj added-item';
                        row.id = `row-${cardId}-${jan}`;
                        row.innerHTML = `
                            <div class="combo-item-left">
                                <span class="combo-item-name">${escapeHtml(product.name)}</span>
                                <div class="combo-item-price"><span class="price-tag retail"><span class="price-tag-label">å®šä¾¡</span>Â¥${product.official_price.toLocaleString()}</span><span class="price-arrow">â†’</span><span class="price-tag buyback"><span class="price-tag-label">è²·å–</span>Â¥${product.buyback_price.toLocaleString()}</span></div>
                            </div>
                            <div class="combo-item-right">
                                <span class="combo-item-rate ${rateClass}">${product.rate}%</span>
                                <div class="qty-adj">
                                    <button class="qty-btn minus" onclick="adjustCardQty('${cardId}','${jan}',-1)">âˆ’</button>
                                    <span class="qty-value has-items" id="qty-${cardId}-${jan}">1</span>
                                    <button class="qty-btn plus" onclick="adjustCardQty('${cardId}','${jan}',1)">ï¼‹</button>
                                </div>
                            </div>
                        `;
                        itemsDiv.appendChild(row);
                    }
                }
            }

            const qty = window._cardQty[cardId] || {};
            qty[jan] = (qty[jan] || 0) + 1;
            window._cardQty[cardId] = qty;

            const qtyEl = document.getElementById(`qty-${cardId}-${jan}`);
            if (qtyEl) {
                qtyEl.textContent = qty[jan];
                qtyEl.className = 'qty-value has-items';
            }

            recalcCard(cardId);
        }
        // ============================================
        // ============================================
        // å•†å“ä¸€è¦§è¡¨ç¤º
        // ============================================
        function renderProducts() {
            const listEl = document.getElementById('productsList');
            
            let filtered = currentCategory === 'all' 
                ? allProducts 
                : allProducts.filter(p => getCategory(p) === currentCategory);
            
            // è²·å–ç‡ã§ã‚½ãƒ¼ãƒˆ
            filtered.sort((a, b) => b.rate - a.rate);
            
            if (filtered.length === 0) {
                listEl.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <p>å•†å“ãŒã‚ã‚Šã¾ã›ã‚“</p>
                    </div>
                `;
                return;
            }
            
            listEl.innerHTML = filtered.map(product => {
                const rateClass = product.rate >= 100 ? 'excellent' : 
                                  product.rate >= 95 ? 'good' : 'normal';
                const categoryLabels = { switch2: 'Switch 2', switch: 'Switch', ps5: 'PS5', steam: 'Steam Deck', meta: 'Meta Quest', other: 'ãã®ä»–' };
                const cat = getCategory(product);
                const catLabel = categoryLabels[cat] || product.brand;
                const profit = product.buyback_price - product.official_price;
                const profitSign = profit >= 0 ? '+' : '';
                const profitClass = profit >= 0 ? 'profit-plus' : 'profit-minus';
                
                return `
                    <div class="product-item">
                        <div class="product-info">
                            <div class="product-name">${escapeHtml(product.name)}</div>
                            <div class="product-meta">
                                <span class="cat-label cat-${cat}">${escapeHtml(catLabel)}</span>
                                JAN: ${product.jan}
                            </div>
                        </div>
                        <div class="product-price-row">
                            <span class="price-tag retail"><span class="price-tag-label">å®šä¾¡</span>Â¥${product.official_price.toLocaleString()}</span>
                            <span class="price-arrow">â†’</span>
                            <span class="price-tag buyback"><span class="price-tag-label">è²·å–</span>Â¥${product.buyback_price.toLocaleString()}</span>
                            <span class="product-profit ${profitClass}">${profitSign}Â¥${profit.toLocaleString()}</span>
                            <span class="product-rate ${rateClass}">${product.rate}%</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ============================================
        // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
        // ============================================
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ============================================
        // æ‰‹å‹•ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
        // ============================================
        const cart = {}; // { jan: qty }
        let manualCategoryFilter = 'all';

        function renderManualProducts() {
            const container = document.getElementById('manualProducts');
            let filtered = manualCategoryFilter === 'all'
                ? allProducts
                : allProducts.filter(p => getCategory(p) === manualCategoryFilter);
            
            filtered.sort((a, b) => b.rate - a.rate);

            container.innerHTML = filtered.map(p => {
                const qty = cart[p.jan] || 0;
                const rateClass = p.rate >= 100 ? 'excellent' : p.rate >= 95 ? 'good' : 'normal';
                const inCart = qty > 0 ? 'in-cart' : '';
                return `
                    <div class="manual-product-row ${inCart}">
                        <div class="mp-info">
                            <div class="mp-name">${escapeHtml(p.name)}</div>
                            <div class="mp-prices-row">
                                <span class="price-tag retail"><span class="price-tag-label">å®šä¾¡</span>Â¥${p.official_price.toLocaleString()}</span>
                                <span class="price-arrow">â†’</span>
                                <span class="price-tag buyback"><span class="price-tag-label">è²·å–</span>Â¥${p.buyback_price.toLocaleString()}</span>
                            </div>
                        </div>
                        <div class="mp-rate ${rateClass}">${p.rate}%</div>
                        <div class="mp-qty">
                            <button class="qty-btn minus" onclick="changeQty('${p.jan}', -1)">âˆ’</button>
                            <span class="qty-value ${qty > 0 ? 'has-items' : ''}">${qty}</span>
                            <button class="qty-btn plus" onclick="changeQty('${p.jan}', 1)">ï¼‹</button>
                        </div>
                    </div>
                `;
            }).join('');

            updateSummary();
        }

        function changeQty(jan, delta) {
            const current = cart[jan] || 0;
            const newQty = Math.max(0, current + delta);
            if (newQty === 0) {
                delete cart[jan];
            } else {
                cart[jan] = newQty;
            }
            renderManualProducts();
        }

        function updateSummary() {
            const summaryEl = document.getElementById('manualSummary');
            const gridEl = document.getElementById('summaryGrid');
            const totalItems = Object.values(cart).reduce((s, q) => s + q, 0);

            if (totalItems === 0) {
                summaryEl.style.display = 'none';
                return;
            }
            summaryEl.style.display = 'block';

            const points = parseInt(document.getElementById('manualPointsInput').value) || 50000;
            let totalPrice = 0;
            let totalBuyback = 0;

            for (const [jan, qty] of Object.entries(cart)) {
                const p = allProducts.find(x => x.jan === jan);
                if (p) {
                    totalPrice += p.official_price * qty;
                    totalBuyback += p.buyback_price * qty;
                }
            }

            const avgRate = totalPrice > 0 ? Math.round((totalBuyback / totalPrice) * 10000) / 100 : 0;
            const profit = totalBuyback - totalPrice;
            const pointsUsed = Math.min(totalPrice, points);
            const cashOut = Math.max(0, totalPrice - points);
            const utilizationPct = Math.min(100, Math.round((totalPrice / points) * 10000) / 100);
            const isOver = totalPrice > points;

            const profitClass = profit >= 0 ? 'positive' : 'negative';
            const profitSign = profit >= 0 ? '+' : '';

            gridEl.innerHTML = `
                <div class="summary-item">
                    <div class="summary-value">${totalItems}ç‚¹</div>
                    <div class="summary-label">å•†å“æ•°</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value">Â¥${totalPrice.toLocaleString()}</div>
                    <div class="summary-label">åˆè¨ˆå®šä¾¡</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value">Â¥${totalBuyback.toLocaleString()}</div>
                    <div class="summary-label">åˆè¨ˆè²·å–</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value">${avgRate}%</div>
                    <div class="summary-label">å¹³å‡è²·å–ç‡</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value ${profitClass}">${profitSign}Â¥${profit.toLocaleString()}</div>
                    <div class="summary-label">æç›Š</div>
                </div>
                <div class="summary-item">
                    <div class="summary-value ${isOver ? 'over-budget' : ''}">Â¥${cashOut.toLocaleString()}</div>
                    <div class="summary-label">${isOver ? 'âš ï¸ æ‰‹å‡ºã—' : 'æ‰‹å‡ºã—'}</div>
                </div>
                <div class="summary-bar">
                    <div class="progress-track">
                        <div class="progress-fill ${isOver ? 'over' : ''}" style="width: ${Math.min(utilizationPct, 100)}%"></div>
                    </div>
                    <div class="progress-label">ãƒã‚¤ãƒ³ãƒˆæ¶ˆåŒ– ${utilizationPct}%ï¼ˆ${pointsUsed.toLocaleString()}å†† / ${points.toLocaleString()}å††ï¼‰</div>
                </div>
            `;
        }

        // ============================================
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        // ============================================
        
        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                btn.classList.add('active');
                document.getElementById(`tab-${btn.dataset.tab}`).classList.add('active');
            });
        });

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒœã‚¿ãƒ³ï¼ˆå…¨å•†å“ä¸€è¦§ï¼‰
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentCategory = btn.dataset.category;
                renderProducts();
            });
        });

        // æ‰‹å‹•ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã®ã‚«ãƒ†ã‚´ãƒªãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        document.querySelectorAll('.manual-filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.manual-filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                manualCategoryFilter = btn.dataset.mcat;
                renderManualProducts();
            });
        });

        // æ¤œç´¢ãƒœã‚¿ãƒ³
        document.getElementById('searchBtn').addEventListener('click', executeSearch);

        // æ‰‹å‹•ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã®ãƒã‚¤ãƒ³ãƒˆå…¥åŠ›å¤‰æ›´
        document.getElementById('manualPointsInput').addEventListener('input', updateSummary);

        // Enterã‚­ãƒ¼ã§æ¤œç´¢
        document.querySelectorAll('.form-input').forEach(input => {
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') executeSearch();
            });
        });

        // ============================================
        // åˆæœŸåŒ–
        // ============================================
        loadData();
    </script>
</body>
</html>
